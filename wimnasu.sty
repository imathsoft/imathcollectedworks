\usepackage{latexsym,amsfonts,amssymb,amsmath,amsthm}
\usepackage{graphics,graphicx,longtable,array,euscript,epsfig}
\usepackage{cite}
\usepackage[T2A]{fontenc}
\usepackage[cp1251]{inputenc}
\usepackage[russian,ukrainian,english]{babel}
\usepackage{import}
%\usepackage[breaklinks,backref=page]%
%{hyperref}

\usepackage[breakall]{truncate}
%\usepackage[stable]{footmisc}
%Subcations for subfigures
\usepackage{caption,subcaption}
%This package is needed to redefine the label and ref commands
%see http://tex.stackexchange.com/questions/85956/redefining-label-and-ref-when-using-hyperref
% for more info 2
\usepackage{letltxmacro}
%We use patchcmd from the next package
%\usepackage{etoolbox}

\setlength{\textwidth}{111.0mm}\setlength{\textheight}{166.0mm}
\setlength{\oddsidemargin}{0in}\setlength{\evensidemargin}{0in}
\setlength{\topmargin}{-1cm}
\setlength{\parindent}{5.0mm}

\usepackage{showkeys}
\sloppy

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%                  Issue related definitions                  %%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%Used to define the counter correspondence 
%We use the work counter to count the number of article in the issue.
%Next package provide the command to attach every local paper counter 
%to the counter work and reset all them in one \refstepcounter command in 
%the redefinition of subimport 
\usepackage{chngcntr}


%Define new counter which is used to count articles 
%and reset per article counter in a single command
\newcounter{work}
\counterwithin*{section}{work}
\counterwithin*{figure}{work}
\counterwithin*{table}{work}
%Force to reset the equation counter, since it may not be
%set to 0 automatically if the article do not contain sections
\counterwithin*{equation}{work}

%Metadata for the issue
\def\metadata@issue@vol{11}
\def\metadata@issue@number{1}
\def\metadata@issue@year{2014}

%\newcommand{\Vykh}[2]{\thispagestyle{empty}
%\newpage\noindent\raisebox{12pt}[0pt][0pt] {\makebox[\textwidth]
%{\foreignlanguage{ukrainian}{\protect\small\sf Збірник праць Iнституту математики НАН України \hfill \metadata@issue@year, т.\,\metadata@issue@vol, №\,\metadata@issue@number,
% \pageref{#1}--\pageref{#2}}}}}

%Redefine the subimport to reset all local paper counters
%\renewcommand{\subimport}[2]{%
%\refstepcounter{work} %
%\clearpage
%\begingroup
%\old@subimport{#1}{#2}
%\endgroup
%}
%We need to retain the original definitions of the label, pageref
\let\old@label\label
\let\old@ref\ref%
\let\old@pageref\pageref%

%Define new command subimportwork to be used in the main issue file only.
%It handles:
% 1. Local article counter reset.
% 2. The definition of two labels for the first and last page of the article.
% 3. Insulate local definitions from the main file and other articles 
\let\old@subimport\subimport
\newcommand{\subimportwork}[2]{%
	\refstepcounter{work}%
	\clearpage
	\begingroup
		\label{firstpage}
		\old@subimport{#1}{#2}
		\label{lastpage}
		\clearpage
	\endgroup
}

%The main idea is to automate the creation of labels for the first and the last page of each work. 
%There might be several ways to achieve this.
%One of which is to try to redefine the \subimport command 
%and add to it the label creation.
%In this case we are gonna need the ability to define labels  
%with auto-incrementing numbers at the end.
%Try  to use  the command 
%\newcommand{\addnextlabel}{\stepcounter{foo}%
%  \edef\baz{\noexpand\label{bar:arabic{foo}}}%
%  \baz
%}
%(see http://tex.stackexchange.com/questions/6413/building-labels-out-of-counters
%and 
%http://tex.stackexchange.com/questions/21300/custom-counter-and-cross-referencing
%and 
%http://tex.stackexchange.com/questions/39380/what-exactly-do-csname-and-endcsname-do
% for discussion )
%
%Some additional hints can be found at 
%http://code.google.com/p/dpctex/source/browse/trunk/numdef/numdef.sty
%
%Useful info on latex and tex counters:
%http://www.texdev.net/2009/11/17/tex-counts-and-latex-counters/

%Here we redine the \label and related reference commands to modify label keys by adding chapter number in front of the key 
%It allows to have the same label in the different files
\AtBeginDocument{%
	\LetLtxMacro{\TheRealLabel}{\label}%
	\LetLtxMacro{\TheRealRef}{\ref}%
	\LetLtxMacro{\TheRealPageRef}{\pageref}%
	%Next two are the subordinate commands of \bibitem
	\LetLtxMacro{\@old@bibitem}{\@bibitem}%
	\LetLtxMacro{\@old@lbibitem}{\@lbibitem}%the bib
%    \LetLtxMacro{\@old@citex}{\@citex}%the bib
%    \LetLtxMacro{\@old@cite}{\@cite}%the bib
	% redefining \label, \ref, \pageref (\renewcommand or \DeclareRobustCommand)
	\gdef\label#1{\TheRealLabel{\roman{work}:#1}}
	\gdef\ref#1{\TheRealRef{\roman{work}:#1}}
	\gdef\pageref#1{\TheRealPageref{\roman{work}:#1}}
	\gdef\@bibitem#1{\@old@bibitem{\roman{work}:#1}}
	\gdef\@lbibitem[#1]#2{\@old@lbibitem[#1]{\roman{work}:#2}}
	%In order to modify the citation tag writen to the aux file by cite package 
	%we need to redefine the following command 
	%(Need to be used with \usepackage{cite})
	\gdef\@cite@ignsp@#1,#2{\roman{work}:#1\ifx\:#2\@empty\expandafter\@gobblethree
	\else,\expandafter\@cite@ignsp@\fi #2}
    %For the ordinary latex citations one might want to look into the redefinition of \@nocite, or \@cite 
%	\gdef\@nocite[#1]#2{\@old@citex[#1]{\roman{work}:#2}}
%	\gdef\@cite#1#2{\@old@cite{\roman{work}:#1}{\roman{work}:#2}}
	\LetLtxMacro{\ltx@label}{\label}%
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%           End of issue related definitions                  %%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\newcommand{\UDC}[1]{\vspace{-24pt}
\begin{flushleft}
\foreignlanguage{ukrainian}{\tt #1}
\end{flushleft}}

\newcommand{\Title}[1]{\begin{flushleft}\LARGE \bfseries #1\end{flushleft}}
\newcommand{\Author}[1]{\begin{flushleft}\bfseries\itshape #1\end{flushleft}}
\newcommand{\Address}[1]{\begin{flushleft}\it #1 \end{flushleft}}

\newcommand{\Abstract}[1]{\begin{flushright}\begin{minipage}{105mm}\small #1\end{minipage}\end{flushright}}

\def\ehkol{Author}
\def\ohkol{\truncate{5cm}{Title}}

\renewcommand{\@evenhead}{%
	\hspace*{-3pt}\raisebox{-15pt}[\headheight][0pt]{%
		\vbox{\hbox to \textwidth{\thepage \hfil \ehkol}\vskip3pt \hrule}}}
\renewcommand{\@oddhead}{%
	\hspace*{-3pt}\raisebox{-15pt}[\headheight][0pt]{
		\vbox{\hbox to \textwidth{\ohkol \hfil \thepage}\vskip3pt\hrule}}}
\renewcommand{\@evenfoot}{}
\renewcommand{\@oddfoot}{}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%% Maketitle related commands and definitons
%We would like to have an optional argument for \title and \author commands. 
%This short version is needed to keep the text only version of title or author's text 
%free of the non-robust commands (like \thanks for example).
%To achieve that we borrow a trick from the \chapter command's definition.
\renewcommand{\title}{\@dblarg{\settitle}}
\gdef\settitle[#1]#2{\gdef\@stitle{#1}\gdef\@title{#2}}
\renewcommand{\author}{\@dblarg{\setauthor}}
\gdef\setauthor[#1]#2{\gdef\@sauthor{#1}\gdef\@author{#2}}
\def\@udc{\vphantom{\CYRU\CYRD\CYRK}}
%\def\@udc{\@empty}
\newcommand{\udc}[1]{\gdef\@udc{#1}}
\def\@address{\@empty}
\newcommand{\address}[1]{\gdef\@address{#1}}
%Commands to typeset abstract
\gdef\@tsabstract#1{\begin{flushright}\begin{minipage}{105mm}\small #1\end{minipage}\end{flushright}}
\def\@abstractua{\@empty}
\newcommand{\abstractua}[1]{\gdef\@abstractua{\foreignlanguage{ukrainian}{#1}}}
\def\@abstractru{\@empty}
\newcommand{\abstractru}[1]{\gdef\@abstractru{\foreignlanguage{russian}{#1}}}
\def\@abstracten{\@empty}
\newcommand{\abstracten}[1]{\gdef\@abstracten{\foreignlanguage{english}{#1}}}

\renewcommand\maketitle{\par
  \begingroup
    \renewcommand\thefootnote{\@fnsymbol\c@footnote}%
    \def\@makefnmark{\rlap{\@textsuperscript{\normalfont\@thefnmark}}}%
    \long\def\@makefntext##1{\parindent 1em\noindent
            \hb@xt@1.8em{%
                \hss\@textsuperscript{\normalfont\@thefnmark}}##1}%
    \global\@topnum\z@   % Prevents figures from going at top of page.
    \@maketitle
    \thispagestyle{empty}
    \@thanks
    \let\thefootnote\relax
    \footnotetext{\hfill\copyright \ \ {\bf \@author, \metadata@issue@year}}
    %Dfine headers and footers
    \xdef\ehkol{\@sauthor}
    \xdef\ohkol{\noexpand\truncate{0.95\textwidth}{\@stitle}}
  \endgroup
  \setcounter{footnote}{0}%
%  \global\let\thanks\relax
%  \global\let\maketitle\relax
%  \global\let\@maketitle\relax
  \global\def\@udc{\vphantom{\CYRU\CYRD\CYRK}}%\@empty %\vphantom{\CYRU\CYRD\CYRK}
  \global\let\@thanks\@empty
  \global\let\@author\@empty
  \global\let\@date\@empty
  \global\let\@title\@empty
  \global\let\@address\@empty
  \global\let\@abstractua\@empty
  \global\let\@abstractru\@empty
  \global\let\@abstracten\@empty
%  \global\let\udc\relax
%  \global\let\title\relax
%  \global\let\author\relax
%  \global\let\address\relax
%  \global\let\date\relax
%  \global\let\and\relax
}
\def\@maketitle{%
%  \newpage
%  \null
   \let \footnote \thanks
   \def\work@front@header{\makebox[\textwidth]%
 	{%
 		\foreignlanguage{ukrainian}{\protect\small\sf Збірник праць Iнституту математики НАН України \hfill  \metadata@issue@year, т.\,\metadata@issue@vol, №\,\metadata@issue@number,
		\old@pageref{\roman{work}:firstpage}--\old@pageref{\roman{work}:lastpage}%
	 	}
 	}%
%		\pageref{firstpage}--\pageref{lastpage}
% 	\TheRealPageref{\roman{work}:firstpage}--\TheRealPageref{\roman{work}:lastpage}%
   }   
   \noindent\raisebox{36pt}[0pt][0pt] {\work@front@header}\par%
   \vspace*{-2.5em}
   \noindent\foreignlanguage{ukrainian}{\texttt{УДК \@udc}}\par%
   \vspace*{-0.5em}
   \begin{flushleft}\LARGE \bf \@title\end{flushleft}\par%
%   \vspace*{-2em}
   \begin{flushleft}\bfseries\itshape \@author\end{flushleft}\par%
   \vspace*{-1.5em}
   \begin{flushleft}\itshape \@address \end{flushleft}\par%
   \@tsabstract{\@abstracten}
   \@tsabstract{\@abstractua}
   \@tsabstract{\@abstractru}
   \vskip 1.5em
   }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\renewcommand{\section}{\@startsection{section}{1}{\z@}%
                                 {-3.35ex \@plus -1ex \@minus -.2ex}%
                                 {2.0ex \@plus .2ex}%
                                 {\normalfont\large\bfseries}}
\renewcommand{\subsection}{\@startsection{subsection}{2}{\z@}%
                                     {-3.25ex\@plus -1ex \@minus -.2ex}%
                                     {1.5ex \@plus .2ex}%
                                     {\normalfont\normalsize\bfseries}}
\renewcommand{\subsubsection}{\@startsection{subsubsection}{3}{\z@}%
                                     {-3.25ex\@plus -1ex \@minus -.2ex}%
                                    {1.5ex \@plus .2ex}%
                                     {\normalfont\normalsize\bfseries}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
%Floats fromatting
% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
%If you want a caption without number but 
%with the word figure then write 
%	  \renewcommand{\thefigure}{}
%inside the figure environment 
\renewcommand{\thetable}{\arabic{table}}
\renewcommand{\thefigure}{\arabic{figure}}
%We intentionally move period into the definition of the number for floats.
%The reason is that if one has a single float in the paper there is not point to print number. In that case use the reciept above to avoid that.
\captionsetup{font={small}, labelsep={period},labelfont=bf}
\captionsetup[subfigure]{labelformat=simple,labelfont=it}
% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Define new theorem styles to make them independent on the changes 
%in amsthm package
\newtheoremstyle{plainstyle} % name
{\topsep}                    % Space above
{\topsep}                    % Space below
{\itshape}                   % Body font
{\parindent}                 % Indent amount
{\bfseries}                  % Theorem head font
{.}                          % Punctuation after theorem head
{.5em}                       % Space after theorem head
{}  % Theorem head spec (can be left empty, meaning ‘normal’)

\newtheoremstyle{definitionstyle} % name
{\topsep}                    % Space above
{\topsep}                    % Space below
{\normalfont}                % Body font
{\parindent}                 % Indent amount
{\bfseries}                  % Theorem head font
{.}                          % Punctuation after theorem head
{.5em}                       % Space after theorem head
{}  % Theorem head spec (can be left empty, meaning ‘normal’)

\newtheoremstyle{remarkstyle} % name
{\topsep}                    % Space above
{\topsep}                    % Space below
{\normalfont}                % Body font
{\parindent}                 % Indent amount
{\bfseries}                  % Theorem head font
{.}                          % Punctuation after theorem head
{.5em}                       % Space after theorem head
{}  % Theorem head spec (can be left empty, meaning ‘normal’)
%\theoremstyle{mytheoremstyle}
%\newtheorem{thm}{Theorem}

\newtheorem{theorem}{\protect\theoremname}[section]
\newtheorem{lemma}{\protect\lemmaname}[section]
\newtheorem{definition}{\protect\definitionname}[section]
\newtheorem{problem}{\protect\problemname}[section]
\newtheorem{conjecture}{\protect\conjecturename}[section]
\newtheorem{assumption}{\protect\assumptionname}[section]
\newtheorem{corollary}{\protect\corollaryname}[section]
\newtheorem{proposition}{\protect\propositionname}[section]
\newtheorem{remark}{\protect\remarkname}[section]
\newtheorem{algorithm}{\protect\algorithname}[section]
\newtheorem{example}{\protect\examplename}[section]
\newcommand{\theoremname}{}
\newcommand{\lemmaname}{}
\newcommand{\definitionname}{}
\newcommand{\problemname}{}
\newcommand{\conjecturename}{}
\newcommand{\assumptionname}{}
\newcommand{\corollaryname}{}
\newcommand{\propositionname}{}
\newcommand{\remarkname}{}
\newcommand{\algorithname}{}
\newcommand{\examplename}{}
\providecommand{\bbljan}{}
\providecommand{\bblfeb}{}
\providecommand{\bblmar}{}
\providecommand{\bblapr}{}
\providecommand{\bblmay}{}
\providecommand{\bbljun}{}
\providecommand{\bbljul}{}
\providecommand{\bblaug}{}
\providecommand{\bblsep}{}
\providecommand{\bbloct}{}
\providecommand{\bblnov}{}
\providecommand{\bbldec}{}
%\newcommand{\proofname}{}

\addto\captionsenglish{%
	\renewcommand{\theoremname}{Theorem}%
	\renewcommand{\lemmaname}{Lemma}
	\renewcommand{\definitionname}{Definition}
	\renewcommand{\examplename}{Example}%
	\renewcommand{\problemname}{Problem}
	\renewcommand{\conjecturename}{Conjecture}
	\renewcommand{\assumptionname}{Assumption}
	\renewcommand{\corollaryname}{Corollary}
	\renewcommand{\propositionname}{Proposition}
	\renewcommand{\remarkname}{Remark}
	\renewcommand{\algorithname}{Algorithm}
	\renewcommand{\algorithname}{Proof}
	\renewcommand{\thesubfigure}{\asbuk{subfigure}.}
	\renewcommand{\tablename}{Table}
	\renewcommand{\refname}{}
	\renewcommand{\bbljan}{jan}
	\renewcommand{\bblfeb}{feb}
	\renewcommand{\bblmar}{mar}
	\renewcommand{\bblapr}{apr}
	\renewcommand{\bblmay}{may}
	\renewcommand{\bbljun}{jun}
	\renewcommand{\bbljul}{jul}
	\renewcommand{\bblaug}{aug}
	\renewcommand{\bblsep}{sep}
	\renewcommand{\bbloct}{oct}
	\renewcommand{\bblnov}{nov}
	\renewcommand{\bbldec}{dec}
}


\addto\captionsrussian{%
	\renewcommand{\theoremname}{Теорема}%
	\renewcommand{\lemmaname}{Лемма}
	\renewcommand{\definitionname}{Определения}
	\renewcommand{\examplename}{Пример}%
	\renewcommand{\problemname}{Задача}
	\renewcommand{\conjecturename}{Гипотеза}
	\renewcommand{\assumptionname}{Предположение}
	\renewcommand{\corollaryname}{Следствие}
	\renewcommand{\propositionname}{Предложение}
	\renewcommand{\remarkname}{Замечание}
	\renewcommand{\algorithname}{Алгоритм}
	\renewcommand{\proofname}{Доказательство}
	\renewcommand{\figurename}{Рис}
	\renewcommand{\thesubfigure}{\asbuk{subfigure}.}
	\renewcommand{\tablename}{Таблиця}
	\renewcommand{\refname}{}
	\renewcommand{\bbljan}{янв}
	\renewcommand{\bblfeb}{фев}
	\renewcommand{\bblmar}{март}
	\renewcommand{\bblapr}{апр}
	\renewcommand{\bblmay}{май}
	\renewcommand{\bbljun}{июнь}
	\renewcommand{\bbljul}{июль}
	\renewcommand{\bblaug}{авг}
	\renewcommand{\bblsep}{сент}
	\renewcommand{\bbloct}{окт}
	\renewcommand{\bblnov}{ноя}
	\renewcommand{\bbldec}{дек}
}

\addto\captionsukrainian{%
	\renewcommand{\theoremname}{Теорема}%
	\renewcommand{\lemmaname}{Лема}%
	\renewcommand{\definitionname}{Означення} %
	\renewcommand{\examplename}{Приклад}%
	\renewcommand{\problemname}{Задача} %
	\renewcommand{\conjecturename}{Гіпотеза}%
	\renewcommand{\assumptionname}{Припущення}%
	\renewcommand{\corollaryname}{Наслідок}%
	\renewcommand{\propositionname}{Твердження}%
	\renewcommand{\remarkname}{Зауваження}%
	\renewcommand{\algorithname}{Алгоритм}%
	\renewcommand{\proofname}{Доведення}%
	\renewcommand{\figurename}{Рис}
	\renewcommand{\thesubfigure}{\asbuk{subfigure}.}
	\renewcommand{\tablename}{Таблиця}
	\renewcommand{\refname}{}
	\renewcommand{\bbljan}{січ}
	\renewcommand{\bblfeb}{лют}
	\renewcommand{\bblmar}{бер}
	\renewcommand{\bblapr}{квіт}
	\renewcommand{\bblmay}{трав}
	\renewcommand{\bbljun}{черв}
	\renewcommand{\bbljul}{лип}
	\renewcommand{\bblaug}{серп}
	\renewcommand{\bblsep}{верес}
	\renewcommand{\bbloct}{жовт}
	\renewcommand{\bblnov}{листоп}
	\renewcommand{\bbldec}{груд}
}

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
%Support for obsolete features
%Will be removed in the next revision!!!
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\AbsEng}[1]{\foreignlanguage{english}{\Abstract{#1}}}
\newcommand{\AbsUkr}[1]{\foreignlanguage{ukrainian}{\Abstract{#1}}}
\newcommand{\AbsRus}[1]{\foreignlanguage{russian}{\Abstract{#1}}}

\renewcommand{\proof}[1]{\hspace{\parindent}\textbf{\textit{\proofname}} #1}
%\newcommand{\proof}[1]{\hspace{\parindent}\textbf{\textit{Proof.}} #1}
%\newcommand{\proofru}[1]{\hspace{\parindent}\textbf{\textit{Доказательство.}} #1}
%\newcommand{\proofuk}[1]{\hspace{\parindent}\textbf{\textit{Доведення.}} #1}

%\renewcommand{\fnum@figure}{\normalfont\small\bfseries{Рис.~\thefigure}\normalfont\small}
%\renewcommand{\fnum@table}{\normalfont\small\bfseries{Таб.~\thetable}\normalfont\small}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
